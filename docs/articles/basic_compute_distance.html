<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Computing the Wasserstein distance • T4transport</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Computing the Wasserstein distance">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">T4transport</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/basic_compute_distance.html">Computing the Wasserstein distance</a></li>
    <li><hr class="dropdown-divider"></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/kisung_you" aria-label="Twitter/X"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kisungyou/T4transport" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../mailto:kisung.you@outlook.com" aria-label="Email"><span class="fa fa-envelope"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Computing the Wasserstein distance</h1>
            
      

      <div class="d-none name"><code>basic_compute_distance.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The Wasserstein distance <span class="citation">(Villani 2003)</span>
provides a natural and geometrically meaningful way to compare
probability distributions. Unlike traditional dissimilarities such as
Kullback–Leibler divergence or total variation, it reflects the minimal
``cost’’ of transporting one distribution to another, with respect to an
underlying geometry of the sample space.</p>
<p>Formally, the <span class="math inline">\(p\)</span>-Wasserstein
distance between two probability measures <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\nu\)</span> on a metric space <span class="math inline">\((\mathcal{X}, d)\)</span> is defined as:</p>
<p><span class="math display">\[
W_p(\mu, \nu) = \left( \inf_{\gamma \in \Gamma(\mu, \nu)}
\int_{\mathcal{X} \times \mathcal{X}} d(x, y)^p \, d\gamma(x, y)
\right)^{1/p},
\]</span></p>
<p>where <span class="math inline">\(\Gamma(\mu, \nu)\)</span> denotes
the set of all couplings (i.e., joint distributions) with marginals
<span class="math inline">\(\mu\)</span> and <span class="math inline">\(\nu\)</span>. This is known as the Kantrovich
formulation <span class="citation">(Kantorovitch 1958)</span>, which
differs from the original formulation by <span class="citation">Monge
(1781)</span> and yet arises the equivalent measure of distance under
mild conditions.</p>
</div>
<div class="section level2">
<h2 id="toy-example">Toy example<a class="anchor" aria-label="anchor" href="#toy-example"></a>
</h2>
<p>We use two artificial datasets - <code>cassini</code> and
<code>smiley</code> - from the <a href="https://CRAN.R-project.org/package=mlbench" class="external-link">mlbench</a> package to
demonstrate the usage of our package. Let’s generate small samples of
cardinality <span class="math inline">\(n=100\)</span>. For visual
clarity, two datasets are first normalized to have mean zero and unit
variance across both dimensions, and the second one is translated by +5
in the <span class="math inline">\(x\)</span>-direction.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mlbench</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate two datasets</span></span>
<span><span class="va">data1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mlbench/man/mlbench.cassini.html" class="external-link">mlbench.cassini</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="va">data2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mlbench/man/mlbench.smiley.html" class="external-link">mlbench.smiley</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">$</span><span class="va">x</span></span>
<span></span>
<span><span class="co"># normalize the datasets</span></span>
<span><span class="va">data1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">data1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># translate the second dataset</span></span>
<span><span class="va">data2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">data2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># plot the datasets</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data1</span>, col<span class="op">=</span><span class="st">"blue"</span>, pch<span class="op">=</span><span class="fl">19</span>, cex<span class="op">=</span><span class="fl">0.5</span>, main<span class="op">=</span><span class="st">"Two datasets"</span>, </span>
<span>     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">7</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"x"</span>, ylab<span class="op">=</span><span class="st">"y"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">data2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">data2</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, col<span class="op">=</span><span class="st">"red"</span>, cex<span class="op">=</span><span class="fl">0.5</span>, pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<p><img src="basic_compute_distance_files/figure-html/toy_code-1.png" alt="Two dataets: Cassini and Smiley" width="700"></p>
<p>As shown in the figure, two datasets are quite different in terms of
their shapes. Moreover, the horizontal translation applied to the second
dataset (<code>smiley</code>) makes it more distinct.</p>
</div>
<div class="section level2">
<h2 id="how-to-compute">How to compute?<a class="anchor" aria-label="anchor" href="#how-to-compute"></a>
</h2>
<p>Per the formulation of Kantrovich, computing the Wasserstein distance
requires solving a linear programming problem. In
<strong>T4transport</strong>, the <code><a href="../reference/wasserstein.html">wasserstein()</a></code> function
achieves that. Let’s see how we can use it. Assume that we consider the
simplest case of order 2.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># call the function</span></span>
<span><span class="va">output</span> <span class="op">=</span> <span class="fu"><a href="../reference/wasserstein.html">wasserstein</a></span><span class="op">(</span><span class="va">data1</span>, <span class="va">data2</span>, p<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print the output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"2-wasserstein distance: "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">distance</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2-wasserstein distance: 5.0194"</span></span></code></pre>
<p>The computed Wasserstein distance of order 2 between the two
empirical measures is 5.0194. Another benefit of the Kantrovich
formulation is that it returns an optimal coupling matrix that matches
elements from two sets. In below, we visualize the attained coupling
<span class="math inline">\(\hat{\Gamma}\)</span> and its overlay as a
bipartite graph.</p>
<p><img src="basic_compute_distance_files/figure-html/compute2-1.png" alt="Optimal matching visualization" width="700"></p>
<p>On the right figure, the edges connecting the dots represent the
optimal coupling between the two empirical measures. The thickness of
the edges is proportional to the amount of mass transported between the
points, which can be interpreted as the “flow” in the transportation
problem.</p>
</div>
<div class="section level2">
<h2 id="alternative-input">Alternative input<a class="anchor" aria-label="anchor" href="#alternative-input"></a>
</h2>
<p>It is often a case where we have cross distances between two
empirical measures, rather than the measures themselves. For instance,
the current <code><a href="../reference/wasserstein.html">wasserstein()</a></code> function only assumes the
Euclidean-valued atoms. In practical scenarios, it is plausible to have
the distances or dissimilarities according to a user-defined metric. The
<code><a href="../reference/wasserstein.html">wassersteinD()</a></code> function is the choice in such
scenarios.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute the cross distance with a helper function</span></span>
<span><span class="va">cross_dist</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">X</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">Y2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">Y</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">X2</span>, <span class="va">Y2</span>, <span class="st">"+"</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">tcrossprod</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">cdist</span> <span class="op">=</span> <span class="fu">cross_dist</span><span class="op">(</span><span class="va">data1</span>, <span class="va">data2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># call the function</span></span>
<span><span class="va">crossed</span> <span class="op">=</span> <span class="fu"><a href="../reference/wasserstein.html">wassersteinD</a></span><span class="op">(</span><span class="va">cdist</span>, p<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print the output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"2-wasserstein distance: "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">crossed</span><span class="op">$</span><span class="va">distance</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2-wasserstein distance: 5.0194"</span></span></code></pre>
<p>Supplying a cross distance matrix also returns the 2-Wasserstein
distance value of 5.0194, which is identical to the value we obtained
before (5.0194).</p>
</div>
<div class="section level2">
<h2 id="disclaimer">Disclaimer<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
</h2>
<p>Computing the Wasserstein distance using a linear programming (LP)
solver is the classical approach based on the Kantrovich formulation. It
is typically included as a core method in any OT libraries. However,
this approach does not scale well to large-scale data, since the LP
problem involves <span class="math inline">\(n\times m\)</span>
variables and requires <span class="math inline">\(\mathcal{O}(n^2)\)</span> memory and at least
<span class="math inline">\(\mathcal{O}(n^3)\)</span> time in the worst
case. For this reason, we bring alternative algorithms in the package
and hope you enjoy exploring them.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-kantorovitch_1958_TranslocationMasses" class="csl-entry">
Kantorovitch, L. 1958. <span>“On the <span>Translocation</span> of
<span>Masses</span>.”</span> <em>Management Science</em> 5 (1): 1–4. <a href="https://doi.org/10.1287/mnsc.5.1.1" class="external-link">https://doi.org/10.1287/mnsc.5.1.1</a>.
</div>
<div id="ref-monge_1781_MemoireTheorieDeblais" class="csl-entry">
Monge, Gaspard. 1781. <em>Mémoire Sur La Théorie Des Déblais Et Des
Remblais</em>. De l’Imprimerie Royale.
</div>
<div id="ref-villani_2003_TopicsOptimalTransportation" class="csl-entry">
Villani, Cédric. 2003. <em>Topics in <span>Optimal</span>
<span>Transportation</span></em>. Vol. 58. Graduate <span>Studies</span>
in <span>Mathematics</span>. S.l.: American Mathematical Society.
</div>
</div>
<!-- pkgdown::build_articles(); pkgdown::preview_site() -->
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kisung You.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
