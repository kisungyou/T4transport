# GENERATE HISTOGRAMS WITH COMMON BREAKS
hist_all = list()
for (i in 1:18){
hist_all[[i]] = hist(stats::rnorm(200, mean=-4, sd=0.5), breaks=bk)
}
for (j in 19:20){
hist_all[[j]] = hist(stats::rnorm(200, mean=+4, sd=0.5), breaks=bk)
}
# COMPUTE THE BARYCENTER AND THE MEDIAN
h_bary = histbary(hist_all)
h_med  = histmed(hist_all)
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(1,3), pty="s")
barplot(hist_all[[1]]$density, col=rgb(0,0,1,1/4),
ylim=c(0, 0.75), main="Two Types")
barplot(hist_all[[20]]$density, col=rgb(1,0,0,1/4),
ylim=c(0, 0.75), add=TRUE)
barplot(h_med$density,  main="Median", ylim=c(0, 0.75))
barplot(h_bary$density, main="Barycenter", ylim=c(0, 0.75))
par(opar)
}
set.seed(100)
bk = seq(from=-10, to=10, length.out=20)
n_signal = 15
# GENERATE HISTOGRAMS WITH COMMON BREAKS
hist_all = list()
for (i in 1:n_signal){
hist_all[[i]] = hist(stats::rnorm(200, mean=-4, sd=0.5), breaks=bk)
}
for (j in (n_signal+1):20){
hist_all[[j]] = hist(stats::rnorm(200, mean=+4, sd=0.5), breaks=bk)
}
# COMPUTE THE BARYCENTER AND THE MEDIAN
h_bary = histbary(hist_all)
h_med  = histmed(hist_all)
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(1,3), pty="s")
barplot(hist_all[[1]]$density, col=rgb(0,0,1,1/4),
ylim=c(0, 0.75), main="Two Types")
barplot(hist_all[[20]]$density, col=rgb(1,0,0,1/4),
ylim=c(0, 0.75), add=TRUE)
barplot(h_med$density,  main="Median", ylim=c(0, 0.75))
barplot(h_bary$density, main="Barycenter", ylim=c(0, 0.75))
par(opar)
n_signal = 12
# GENERATE HISTOGRAMS WITH COMMON BREAKS
hist_all = list()
for (i in 1:n_signal){
hist_all[[i]] = hist(stats::rnorm(200, mean=-4, sd=0.5), breaks=bk)
}
for (j in (n_signal+1):20){
hist_all[[j]] = hist(stats::rnorm(200, mean=+4, sd=0.5), breaks=bk)
}
# COMPUTE THE BARYCENTER AND THE MEDIAN
h_bary = histbary(hist_all)
h_med  = histmed(hist_all)
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(1,3), pty="s")
barplot(hist_all[[1]]$density, col=rgb(0,0,1,1/4),
ylim=c(0, 0.75), main="Two Types")
barplot(hist_all[[20]]$density, col=rgb(1,0,0,1/4),
ylim=c(0, 0.75), add=TRUE)
barplot(h_med$density,  main="Median", ylim=c(0, 0.75))
barplot(h_bary$density, main="Barycenter", ylim=c(0, 0.75))
par(opar)
barplot(h_med$density,  names.arg = round(h_med$mids, 1), las=2, main="Median", ylim=c(0, 0.75))
barplot(h_med$density,  names.arg = round(h_med$mids, 1), main="Median", ylim=c(0, 0.75))
# VISUALIZE
xt   <- names.arg = round(h_med$mids, 1)
# VISUALIZE
xt   <- names.arg = round(h_med$mids, 1)
# VISUALIZE
xt   <- round(h_med$mids, 1)
opar <- par(no.readonly=TRUE)
par(mfrow=c(1,3), pty="s")
barplot(hist_all[[1]]$density, col=rgb(0,0,1,1/4),
ylim=c(0, 0.75), main="Two Types")
barplot(hist_all[[20]]$density, col=rgb(1,0,0,1/4),
ylim=c(0, 0.75), add=TRUE)
barplot(h_med$density,  names.arg=xt, main="Median", ylim=c(0, 0.75))
barplot(h_bary$density, names.arg=xt, main="Barycenter", ylim=c(0, 0.75))
par(opar)
# VISUALIZE
xt   <- round(h_med$mids, 1)
opar <- par(no.readonly=TRUE)
par(mfrow=c(1,3), pty="s")
barplot(hist_all[[1]]$density, col=rgb(0,0,1,1/4),
ylim=c(0, 0.75), main="Two Types", names.arg=xt)
barplot(hist_all[[20]]$density, col=rgb(1,0,0,1/4),
ylim=c(0, 0.75), add=TRUE)
barplot(h_med$density,  names.arg=xt, main="Median", ylim=c(0, 0.75))
barplot(h_bary$density, names.arg=xt, main="Barycenter", ylim=c(0, 0.75))
par(opar)
0help(hist)
help(hist)
set.seed(123)
x_source = rnorm(1000, mean=-5, sd=1/2)
x_target = rnorm(1000, mean=+5, sd=2)
# EXTRACT A COMMON SET OF BREAKS
common_hist = hist(c(x_source, x_target), plot=FALSE)
common_hist$breaks
plot(common_hist)
help(hist)
common_hist = hist(c(x_source, x_target), plot=FALSE, breaks="FD")
common_hist$breaks
common_hist = hist(c(x_source, x_target), plot=FALSE, breaks="Sturges")
common_hist$breaks
seq(from=0, to=1, length.out=5)
# BUILD HISTOGRAMS WITH COMMON BREAKS
bk = seq(from=-8, to=12, by=2)
h1 = hist(x_source, breaks=bk, plot=FALSE)
h2 = hist(x_target, breaks=bk, plot=FALSE)
h1$density
h2$density
#----------------------------------------------------------------------
#                      Interpolating Two Gaussians
#
# The source histogram is created from N(-5,1/4).
# The target histogram is created from N(+5,4)
#----------------------------------------------------------------------
# SETTING
set.seed(123)
x_source = rnorm(1000, mean=-5, sd=1/2)
x_target = rnorm(1000, mean=+5, sd=2)
# BUILD HISTOGRAMS WITH COMMON BREAKS
bk = seq(from=-8, to=12, by=2)
h1 = hist(x_source, breaks=bk, plot=FALSE)
h2 = hist(x_target, breaks=bk, plot=FALSE)
# INTERPOLATE WITH 5 GRID POINTS
h_path <- histinterp(h1, h2, t = seq(0, 1, length.out = 5))
h_path <- histinterp(h1, h2, t = seq(0, 1, length.out = 5))
h_path
h_path[[1]]
# VISUALIZE
y_slim <- c(0, max(h1$density, h2$density)) # shared y-limit
xt     <- round(h_med$mids, 1) # x-ticks
opar <- par(no.readonly = TRUE)
par(mfrow = c(1, 5), pty = "s")
for (i in 1:5){
barplot(h_path[[i]]$density,  names.arg=xt, ylim=y_slim)
}
y_slim <- c(0, max(h1$density, h2$density)) # shared y-limit
xt     <- round(h1$mids, 1) # x-ticks
opar <- par(no.readonly = TRUE)
par(mfrow = c(1, 5), pty = "s")
for (i in 1:5){
barplot(h_path[[i]]$density,  names.arg=xt, ylim=y_slim)
}
par(opar)
#                      Interpolating Two Gaussians
#
# The source histogram is created from N(-5,1/4).
# The target histogram is created from N(+5,4)
#----------------------------------------------------------------------
# SETTING
set.seed(123)
x_source = rnorm(1000, mean=-5, sd=1/2)
x_target = rnorm(1000, mean=+5, sd=2)
# BUILD HISTOGRAMS WITH COMMON BREAKS
bk = seq(from=-8, to=12, by=1)
h1 = hist(x_source, breaks=bk, plot=FALSE)
h2 = hist(x_target, breaks=bk, plot=FALSE)
# INTERPOLATE WITH 5 GRID POINTS
h_path <- histinterp(h1, h2, t = seq(0, 1, length.out = 5))
# VISUALIZE
y_slim <- c(0, max(h1$density, h2$density)) # shared y-limit
xt     <- round(h1$mids, 1) # x-ticks
opar <- par(no.readonly = TRUE)
par(mfrow = c(1, 5), pty = "s")
for (i in 1:5){
barplot(h_path[[i]]$density,  names.arg=xt, ylim=y_slim)
}
par(opar)
# BUILD HISTOGRAMS WITH COMMON BREAKS
bk = seq(from=-8, to=12, by=1)
h1 = hist(x_source, breaks=bk, plot=FALSE)
h2 = hist(x_target, breaks=bk, plot=FALSE)
# INTERPOLATE WITH 5 GRID POINTS
h_path <- histinterp(h1, h2, t = seq(0, 1, length.out = 8))
# VISUALIZE
y_slim <- c(0, max(h1$density, h2$density)) # shared y-limit
xt     <- round(h1$mids, 1) # x-ticks
opar <- par(no.readonly = TRUE)
par(mfrow = c(2,4), pty = "s")
for (i in 1:8){
if (i < 2){
barplot(h_path[[i]]$density,  names.arg=xt, ylim=y_slim,
main="Source", col=rgb(0,0,1,1/4))
} else if (i > 7){
barplot(h_path[[i]]$density,  names.arg=xt, ylim=y_slim,
main="Target", col=rgb(1,0,0,1/4))
} else {
barplot(h_path[[i]]$density,  names.arg=xt, ylim=y_slim,
col="gray90", main=sprintf("t = %.3f", (i-1)/7))
}
}
par(opar)
bk = seq(from=-8, to=12, by=2)
h1 = hist(x_source, breaks=bk, plot=FALSE)
h2 = hist(x_target, breaks=bk, plot=FALSE)
# INTERPOLATE WITH 5 GRID POINTS
h_path <- histinterp(h1, h2, t = seq(0, 1, length.out = 8))
# VISUALIZE
y_slim <- c(0, max(h1$density, h2$density)) # shared y-limit
xt     <- round(h1$mids, 1) # x-ticks
opar <- par(no.readonly = TRUE)
par(mfrow = c(2,4), pty = "s")
for (i in 1:8){
if (i < 2){
barplot(h_path[[i]]$density,  names.arg=xt, ylim=y_slim,
main="Source", col=rgb(0,0,1,1/4))
} else if (i > 7){
barplot(h_path[[i]]$density,  names.arg=xt, ylim=y_slim,
main="Target", col=rgb(1,0,0,1/4))
} else {
barplot(h_path[[i]]$density,  names.arg=xt, ylim=y_slim,
col="gray90", main=sprintf("t = %.3f", (i-1)/7))
}
}
par(opar)
rm(list=ls())
pkgdown::build_site()
pkgdown::build_site()
graphics.off()
rm(list=ls())
pkgdown::build_site()
devtools::document()
pkgdown::build_site()
install.packages(c("e1071", "ggsci", "litedown", "metap", "performance", "RcppArmadillo", "reformulas", "selectr", "statnet.common", "wk"))
X = cbind(c(1,0,-1,0), c(0,1,0,-1))
S = cov(X)
S
eigen(S)
X = (3/2)*X
cov(X)
eigen(cov(X))
X
X
X = 2/3*X
eigen(cov(X))
t(X)%*%X/(3)
pak::pkg_install("rhub", dependencies = TRUE)
rhub::rhub_setup()
rhub::rhub_doctor()
usethis::create_github_token()
gitcreds::gitcreds_set()
rhub::rhub_platforms()
rhub::rhub_doctor()
rhub::rhub_check()
rhub::rhub_check()
pkgdown::build_site()
help(imagebary)
solve_exact = imagebary(datsmall)
data(digit3)
datsmall = digit3[sample(1:2000, 20)]  # select 20 images
# RUN
solve_exact = imagebary(datsmall)
rm(list=ls())
graphics.off()
m = 300
n = 150
X = matrix(rnorm(m*2, mean=-1),ncol=2) # m obs. for X
Y = matrix(rnorm(n*2, mean=+1),ncol=2) # n obs. for Y
run_two = compare_two(X, Y)
image(run_two$plan, main="plan")
image(run_two$dual$G, main="dual plan")
norm(run_two$plan - run_two$dau)
norm(run_two$plan - run_two$dual$G, "F")
rm(list=ls())
graphics.off()
data(digit3)
dat_small = digit3[sample(1:2000, 10)]
# RUN SEQUENTIALLY
run_exact = imagebary(dat_small, maxiter=10)
run_reg   = imagebary14C(dat_small, maxiter=10)
par(mfrow=c(1,2))
image(run_exact)
image(run_reg)
help(imagebary14C)
data(digit3)
dat_small = digit3[sample(1:2000, 5)]
# RUN
run_exact = imagebary(dat_small, maxiter=10)
run_reg_1 = imagebary14C(dat_small, maxiter=10, lambda=0.1)
run_reg_2 = imagebary14C(dat_small, maxiter=10, lambda=1)
run_reg_3 = imagebary14C(dat_small, maxiter=10, lambda=10)
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(2,2), pty="s")
image(run_exact, axes=FALSE, main="Unregularized")
image(run_reg_1, axes=FALSE, main="Reg: lambda=0.1")
image(run_reg_2, axes=FALSE, main="Reg: lambda=1")
image(run_reg_3, axes=FALSE, main="Reg: lambda=10")
par(opar)
run_reg_1 = imagebary14C(dat_small, maxiter=10, lambda=0.001)
run_reg_2 = imagebary14C(dat_small, maxiter=10, lambda=0.01)
run_reg_3 = imagebary14C(dat_small, maxiter=10, lambda=0.1)
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(2,2), pty="s")
image(run_exact, axes=FALSE, main="Unregularized")
image(run_reg_1, axes=FALSE, main="Reg: lambda=0.1")
image(run_reg_2, axes=FALSE, main="Reg: lambda=1")
image(run_reg_3, axes=FALSE, main="Reg: lambda=10")
par(opar)
help("imagebary15B")
run_exact = imagebary(dat_small, maxiter=10)
run_reg_1 = imagebary14C(dat_small, maxiter=10)
run_reg_2 = imagebary15B(dat_small, maxiter=10)
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(1,3), pty="s")
image(run_exact, axes=FALSE, main="Unregularized")
image(run_reg14, axes=FALSE, main="")
run_reg14 = imagebary14C(dat_small, maxiter=10)
run_reg15 = imagebary15B(dat_small, maxiter=10)
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(1,3), pty="s")
image(run_exact, axes=FALSE, main="Unregularized")
image(run_reg14, axes=FALSE, main="")
image(run_reg15, axes=FALSE, main="Benamou et al. (2015)")
par(opar)
# LOAD DATA
set.seed(10)
data(digit3)
dat_small = digit3[sample(1:2000, 5)]
# RUN
run_exact = imagebary(dat_small, maxiter=20)
run_reg14 = imagebary14C(dat_small, maxiter=20)
run_reg15 = imagebary15B(dat_small, maxiter=20)
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(1,3), pty="s")
image(run_exact, axes=FALSE, main="Unregularized")
image(run_reg14, axes=FALSE, main="Cuturi & Doucet (2014)")
image(run_reg15, axes=FALSE, main="Benamou et al. (2015)")
par(opar)
set.seed(11)
data(digit3)
dat_small = digit3[sample(1:2000, 10)]
# RUN
run_exact = imagebary(dat_small, maxiter=20)
run_reg14 = imagebary14C(dat_small, maxiter=20)
run_reg15 = imagebary15B(dat_small, maxiter=20)
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(1,3), pty="s")
image(run_exact, axes=FALSE, main="Unregularized")
image(run_reg14, axes=FALSE, main="Cuturi & Doucet (2014)")
image(run_reg15, axes=FALSE, main="Benamou et al. (2015)")
par(opar)
#----------------------------------------------------------------------
data(digit3)
x <- digit3[[1]]
y <- digit3[[2]]
dxy <- imagedist(x, y)
data(digit3)
x <- digit3[[1]]
y <- digit3[[2]]
dxy <- imagedist(x, y)
dxy$distance
pkgdown::build_site()
data(digit3)
x <- digit3[[1]]
y <- digit3[[2]]
W1 <- imagedist(x, y, p=1)
#----------------------------------------------------------------------
data(digit3)
x <- digit3[[1]]
y <- digit3[[2]]
W1 <- imagedist(x, y, p=1)
W2 <- imagedist(x, y, p=2)
W1$distance
W2$distance
# SHOW RESULTS
print(paste0("Wasserstein-1 distance: ", round(W1$distance,4)))
print(paste0("Wasserstein-2 distance: ", round(W2$distance,4))))
print(paste0("Wasserstein-1 distance: ", round(W1$distance,4)))
print(paste0("Wasserstein-2 distance: ", round(W2$distance,4)))
data(digits)
data(digits)
which(digits$label==1)
sample(which(digits$label==1),1)
digits$image[[1]]
# LOAD DATA
set.seed(11)
data(digits)
x1 <- digits$image[[sample(which(digits$label==1),1)]]
x2 <- digits$image[[sample(which(digits$label==8),1)]]
# COMPUTE
path <- imageinterp(x1, x2, t = seq(0, 1, length.out = 10))
#----------------------------------------------------------------------
# LOAD DATA
set.seed(11)
data(digits)
x1 <- digits$image[[sample(which(digits$label==1),1)]]
x2 <- digits$image[[sample(which(digits$label==8),1)]]
# COMPUTE
path <- imageinterp(x1, x2, t = seq(0, 1, length.out = 10))
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(2,5), pty="s")
for (k in 1:10) image(path[[k]], axes=FALSE, main=sprintf("t=%.2f", (k-1)/5))
par(opar)
tvec <- seq(0, 1, length.out=10)
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(2,5), pty="s")
for (k in 1:10){
image(path[[k]], axes=FALSE, main=sprintf("t=%.2f", tvec[k])
}
opar <- par(no.readonly=TRUE)
par(mfrow=c(2,5), pty="s")
for (k in 1:10){
image(path[[k]], axes=FALSE, main=sprintf("t=%.2f", tvec[k]))
}
par(opar)
pkgdown::build_site()
pkgdown::build_site()
m = 500
n = 500
X = matrix(rnorm(m*2, mean=-1),ncol=2) # m obs. for X
Y = matrix(rnorm(n*2, mean=+1),ncol=2) # n obs. for Y
run_exact = T4transport::wasserstein(X, Y)
run_appro = T4transport::bsp(X, Y)
par(mfrow=c(1,2))
image(run_exact$plan, main=paste0("exact: dist=",round(run_exact$distance,2)))
image(run_appro$plan, main=paste0("bspot: dist=",round(run_appro$distance,2)))
microbenchmark::microbenchmark(
exact = {T4transport::wasserstein(X, Y)},
bsp   = {T4transport::bsp(X, Y)},
times = 5
)
graphics.off()
set.seed(11)
data(digits)
set.seed(11)
data(digits)
dat_8 = digits$image[sample(which(digits$label==8), 7)]
dat_1 = digits$image[sample(which(digits$label==1), 3)]
dat_all = c(dat_8, dat_1)
#----------------------------------------------------------------------
#                             MNIST Example
#
# Use 7 images from digit '8' and 3 images from digit '1'.
# The median should look closer to the shape of '8'.
#----------------------------------------------------------------------
# DATA PREP
set.seed(11)
data(digits)
dat_8 = digits$image[sample(which(digits$label==8), 7)]
dat_1 = digits$image[sample(which(digits$label==1), 3)]
dat_all = c(dat_8, dat_1)
# COMPUTE BARYCENTER AND MEDIAN
img_bary = imagemed(dat_all, maxiter=10)
img_med  = imagemed(dat_all, maxiter=10)
img_med = img_bary
img_bary = imagebary(dat_all, maxiter=10)
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(1,2), pty="s")
image(img_bary, axes=FALSE, main="Barycenter")
image(img_med,  axes=FALSE, main="Median")
par(opar)
norm(img_bary-img_med, "F")
#----------------------------------------------------------------------
#                             MNIST Example
#
# Use 6 images from digit '8' and 4 images from digit '1'.
# The median should look closer to the shape of '8'.
#----------------------------------------------------------------------
# DATA PREP
set.seed(11)
data(digits)
dat_8 = digits$image[sample(which(digits$label==8), 6)]
dat_1 = digits$image[sample(which(digits$label==1), 4)]
dat_all = c(dat_8, dat_1)
# COMPUTE BARYCENTER AND MEDIAN
img_bary = imagebary(dat_all, maxiter=10)
img_med  = imagemed(dat_all, maxiter=10)
# COMPUTE BARYCENTER AND MEDIAN
img_bary = imagebary(dat_all, maxiter=10)
img_med  = imagemed(dat_all, maxiter=10)
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(1,2), pty="s")
image(img_bary, axes=FALSE, print.progress=TRUE, main="Barycenter")
image(img_med,  axes=FALSE, print.progress=TRUE, main="Median")
par(opar)
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(1,2), pty="s")
image(img_bary, axes=FALSE, print.progress=TRUE, main="Barycenter")
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(1,2), pty="s")
image(img_bary, axes=FALSE, main="Barycenter")
image(img_med,  axes=FALSE, main="Median")
par(opar)
# COMPUTE BARYCENTER AND MEDIAN
img_bary = imagebary(dat_all, maxiter=50)
img_med  = imagemed(dat_all, maxiter=50)
# VISUALIZE
opar <- par(no.readonly=TRUE)
par(mfrow=c(1,2), pty="s")
image(img_bary, axes=FALSE, main="Barycenter")
image(img_med,  axes=FALSE, main="Median")
par(opar)
